
# Telegram Views Predictor — Hackathon Solution

**Сервис для прогнозирования охватов (views) рекламных постов в Telegram.**
Решение помогает планировать рекламные бюджеты, предсказывая эффективность поста до его публикации.

Система реализована в виде **веб-сервиса с графическим интерфейсом** (Dashboard) и REST API.

---

## Описание решения

### Проблематика
Главная сложность задачи — **Cold Start**: необходимость давать прогноз для новых каналов, которые отсутствуют в исторической обучающей выборке.

### Архитектура
Для решения используется **гибридный ансамбль (Stacking/Blending)** из трёх моделей, каждая из которых закрывает свою часть задачи:

1.  **KNN (K-Nearest Neighbors):**
    * *Роль:* Поиск «исторических двойников».
    * *Механика:* Находит 10 наиболее похожих каналов по семантике названия (используя TF-IDF на символьных n-граммах + SVD). Это позволяет предсказывать охваты для абсолютно новых каналов, опираясь на похожие кейсы в прошлом.
2.  **CatBoost Regressor:**
    * *Роль:* Основная точность.
    * *Механика:* Градиентный бустинг, отлично работающий с категориальными признаками, датами и нелинейными зависимостями.
3.  **Ridge Regression:**
    * *Роль:* Стабилизация.
    * *Механика:* Линейная модель, которая сглаживает предсказания и предотвращает переобучение ансамбля на выбросах.

**Формула ансамбля:**
```math
Final\_Log\_View = 0.5 \cdot CatBoost + 0.3 \cdot KNN + 0.2 \cdot Ridge

```

**Метрика качества:** ~0.1 (RMSE на логарифмированной целевой переменной).

---

## Используемые признаки (Feature Engineering)

В соответствии с требованиями, модель использует следующие входные данные:

1. **Текстовые признаки (Название канала):**
* Векторизация через `TfidfVectorizer` (analyzer='char_wb', ngram_range=(2,5)).
* Сжатие размерности через `TruncatedSVD` до 100 компонент (LSA).


2. **Временные признаки (из Даты):**
* Месяц, День, День недели.
* Флаг выходного дня (`is_weekend`).


3. **Числовые признаки:**
* `CPM` (стоимость за 1000 показов).
* `Log(CPM)` (логарифм стоимости для нормализации распределения).



---

## Технический стек

* **Язык:** Python 3.10+
* **ML Core:** scikit-learn, CatBoost
* **NLP:** TF-IDF, TruncatedSVD
* **Web/API:** FastAPI, Uvicorn
* **Data:** Pandas, NumPy

---

## Структура проекта

```text
.
├── app.py              # Единая точка входа: Веб-дашборд + API + Обучение
├── train.py            # Отдельный скрипт для offline-обучения
├── models_pro.pkl      # Артефакты модели (Ансамбль + NLP трансформеры)
├── requirements.txt    # Список зависимостей
├── README.md           # Документация
├── train_hack.csv      # Обучающая выборка
├── test_hack.csv       # Тестовая выборка (для валидации)
└── doc-1769013311.csv  # Доп. датасет (используется для расширения словаря NLP)

```

---

## Инструкция по запуску

Сервис имеет встроенную систему обучения. Вам не нужно запускать отдельные скрипты.

### 1. Установка зависимостей

```bash
pip install -r requirements.txt

```

### 2. Запуск приложения

```bash
python app.py

```

### 3. Работа с сервисом

После запуска откройте в браузере: **`http://localhost:8000`**

1. Вы увидите **Live-консоль**, которая автоматически начнет процесс обучения (чтение CSV, генерацию признаков, обучение 3-х моделей).
2. Дождитесь сообщения `=== ОБУЧЕНИЕ ЗАВЕРШЕНО ===`.
3. Используйте появившуюся форму для проверки прогнозов вручную.

---

## Документация API

Сервис полностью соответствует требованиям к Endpoint.
Swagger документация доступна по адресу: `http://localhost:8000/docs`

### Прогноз просмотров (`/predict`)

**URL:** `POST http://localhost:8000/predict`

**Формат запроса (JSON):**

```json
{
  "cpm": 10.5,
  "channel": "crypto_news_daily",
  "date": "2025-10-05"
}

```

**Формат ответа (JSON):**

```json
{
  "predicted_views": 15430
}

```

### Пример вызова через cURL:

```bash
curl -X 'POST' \
  'http://localhost:8000/predict' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "cpm": 5.0,
  "channel": "sport_life_2025",
  "date": "2025-12-01"
}'

```

### Принудительное переобучение (`/train`)

Если вы загрузили новые данные (csv файлы), можно вызвать переобучение без перезагрузки сервера:

```bash
curl -X 'POST' 'http://localhost:8000/train'

```

---

## Автор

```
@dddert - Andrei Volkov
```
